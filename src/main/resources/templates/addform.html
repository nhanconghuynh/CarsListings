<!DOCTYPE html>
<html lang="en" xmlns:th="www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Add New Car Listing Form</title>
    <!--<link href="//netdna.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">-->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <!--<link href="//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap-glyphicons.css" rel="stylesheet">-->
    <!--<link rel="stylesheet" href="/../resources/static/css/custom.css" type="text/css">-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>
    <!--<script src="/../static/js/bootstrap.file-input.js"></script>-->

    <!--<script src="http://gregpike.net/demos/bootstrap-file-input/bootstrap.file-input.js"></script>-->


    <style>

        .navbar-nav {
            line-height:15px;
        }

    .navbar-custom .nav-item.active .nav-link,
    .navbar-custom .nav-item:focus .nav-link,
    .navbar-custom .nav-item:hover .nav-link
    {
        color: #ff3e52;
    }

    .navbar-custom .dropdown-menu .dropdown-item:hover   {
        background-color: rgba(174, 225, 241, 0.51);
    }

    .navbar-custom .dropdown-menu .dropdown-item:focus   {
        background-color: #007BFF;-->
    }
    span.form-error-text { color: red; }
    body { font-size: 116%;}
        form  { display: table;  margin: 0 auto;   }

        p     { display: table-row;  }

        label { display: table-cell; font-weight: bold; }

        input { display: table-cell;}

        img {
            max-width: 200px;
            max-height: 200px;
            width: auto;
            height:auto;
        }

        .form-control:focus {
            border-color: rgba(70, 145, 87, 0.82);
            box-shadow: inset 0 1px 1px rgba(69, 92, 131, 0.15), 0 0 12px rgba(133, 207, 153, 0.6);
        }


        .custom-select:focus {
        border-color: #bf7734;
        box-shadow: inset 0 1px 1px rgba(67, 88, 125, 0.24), 0 0 12px rgba(255, 156, 41, 0.6);
        }

        /*.custom-file-label:after {*/
            /*content: attr(data-content);*/
            /*content: "Testing";*/
        /*}*/

        /*input[type="file"]:before {*/
            /*content: "Choose Car Photo";*/
            /*text-indent: -999em;*/
            /*outline: none;*/
            /*background: #fff;*/
            /*width: 100%;*/
            /*height: 35px;*/
            /*display: block;*/
            /*text-align: left;*/
            /*position: relative;*/
            /*margin: 0;*/
            /*margin: 0 5px;*/
            /*left: -6px;*/
            /*border: 1px solid #e0e0e0;*/
            /*top: -1px;*/
            /*line-height: 35px;*/
            /*color: #b6b6b6;*/
            /*padding-left: 5px;*/
            /*display: block;*/
        /*}*/

    </style>

    <script>
        $(function () {
            $('[data-toggle="popover"]').popover()
        })

        $(function() {
            // Clear event
            $('.image-preview-clear').click(function(){
                // $('.image-preview').attr("data-content","").popover("hide");
                $('#previewImage').attr("data-content","").popover("hide");
                $('#myImage').attr('src', "#");
                $('.image-preview-filename').val("No photo chosen.");
                // $('.image-preview-clear').hide();
                $('.image-preview-input input:file').val("");
                // $(".image-preview-input-title").text("Browse");
            });
            // Create the preview image
            $(".image-preview-input input:file").change(function (event) {
                // var img = $('<img/>', {
                //     id: 'dynamic'
                //     height: auto,
                //     width: 200
                // });
                var file = this.files[0];
                var fieldVal = $(this).val();
                var reader = new FileReader();
                // Set preview image into the popover data-content
                reader.onload = function (e) {
                    // $(".image-preview-input-title").text("Change");
                    // $(".image-preview-clear").show();
                    $(".image-preview-filename").val(file.name);

                    // Change the node's value by removing the fake path (Chrome)
                    // fieldVal = fieldVal.replace("C:\\fakepath\\", "");
                    // fieldVal = $(this).val();

                    // if (fieldVal != undefined || fieldVal != "") {
                    //     $(this).next(".custom-file-label").attr("data-content", fieldVal);
                    //     $(this).next(".custom-file-label").text(fieldVal);
                    // }
                    // $(this).next(".custom-file-label").html(e.target.result.name);

                    // img.attr('src', e.target.result);
                    // img.appendTo($('#myIm"age'));


                    $('#myImage').attr('src', e.target.result);
                    $('#mytestImage').attr('src', e.target.result);
                    // $(".image-preview").popover("show");
                    // $(".image-preview").attr("data-content",$(img)[0].outerHTML).popover("show");

                    // document.getElementById("#displayFilename").value = this.value;

                    $('#previewImage').popover("update");
                    $("#previewImage").attr("data-content", $('#myImage')[0].outerHTML).popover("show");

                }

                if (!event.target.files[0]) {
                    $('#myImage').attr('src', "#");
                    $('#previewImage').attr("data-content", "").popover("hide");
                    $('.image-preview-filename').val("No file chosen.");
                }

                if (event.target.files[0]) {
                    reader.readAsDataURL(file);
                }
            });
        });

    </script>

</head>
<body>
<div th:replace="base :: navlinks"></div>

<form action="#" th:action="@{/addprocess}" th:object="${car}" method="post"
      enctype="multipart/form-data" style="font-size:85%;" >

    <input type="hidden" th:field="*{id}" />


    <div class="form-group">
            <div id="fileInputGroup" class="input-group">
                <!--<div class="input-group-append">-->
                <button type="button" class="btn btn-outline-secondary image-preview-clear">Clear</button>
                <input id="displayFilename" type="text" class="form-control image-preview-filename" disabled placeholder="No photo chosen.">
                <div class="image-preview-input">
                    <span class=" btn btn-outline-primary" onclick="$(this).parent().find('input[type=file]').click();">Choose Car Photo</span>
                    <input id="custominputfile" name="file" class="form-control-file" style="display: none;" type="file" accept="image/png, image/jpeg, image/, image/jpg, image/tiff">
                    <img id="myImage" src="#" alt="No photo." style="display:none;max-height:200px;max-width:200px;height:auto;width:auto;"/>
                    <button id="previewImage" class="btn btn-outline-info" data-toggle="popover"  data-container="body" data-trigger="focus hover" data-html="true" title="Photo Preview" data-placement="bottom"
                            data-content="No photo selected." type="button" >Image Preview</button>
                </div>

            </div><!-- /input-group image-preview [TO HERE]-->
                <!--<div class="input-group-prepend">-->           <!--<div class="input-group-prepend">-->
    </div>  <!-- form group -->

    <span  th:if="${message}">
        <h6 style="color: red" th:text="${message}"> </h6>
    </span>
    </div>

    <br />
    <div class="input-group">
        <label>Category:</label> <select class="custom-select" th:field="*{category}" >

    <option th:unless="${category.idnum == 1}" th:each="category : ${categories}" th:value="${category.id}" th:text="${category.type}">
    </option>

    </select>
    </div>

    <br />

    <div class="input-group">
    <label>Manufacturer:  </label><input class="form-control" type="text" th:field="*{manufacturer}" placeholder="Name of Manufacturer" th:errorclass="form-field-error" />
    <span class="form-error-text" th:if="${#fields.hasErrors('manufacturer')}"
          th:errors="*{manufacturer}"></span>
    </div>
    <br />

    <p>
    <label>Model:</label> <input class="form-control" type="text" th:field="*{carmodel}" th:errorclass="form-field-error" />
    <span class="form-error-text" th:if="${#fields.hasErrors('carmodel')}"
          th:errors="*{carmodel}"></span></p><br />

    <p>
    <label>Trim:</label> <input class="form-control" type="text" th:field="*{cartrim}" th:errorclass="form-field-error" />
    <span class="form-error-text" th:if="${#fields.hasErrors('cartrim')}"
          th:errors="*{carTrim}"></span></p><br />

    <p>
    <label>Year:</label> <input class="form-control" type="text" th:field="*{year}" th:errorclass="form-field-error" />
    <span class="form-error-text" th:if="${#fields.hasErrors('year')}"
          th:errors="*{year}"></span></p><br />

    <p>
    <label>Mileage:</label> <input class="form-control" type="text" th:field="*{mileage}" th:errorclass="form-field-error" />
    <span class="form-error-text" th:if="${#fields.hasErrors('mileage')}"
          th:errors="*{mileage}"></span></p><br />

    <p>
    <label>Color:</label>  <input class="form-control" type="text" th:field="*{color}" th:errorclass="form-field-error" />
    <span class="form-error-text" th:if="${#fields.hasErrors('color')}"
          th:errors="*{color}"></span></p><br />

    <p>
    <label>Listing Price:</label>
    <div class="input-group">
        <div class="input-group-prepend">
        <span class="input-group-text">$</span>
        </div>
        <!--<div th:if="${price}">-->
        <input class="form-control" type="text" th:field="*{price}" placeholder="0.00" step="0.01" style="text-align: right"  />
        <!--</div>-->

        <!--<div th:unless="${price}">-->
        <!--<input class="form-control" type="text" placeholder="0.00" step="0.01"  />-->
        <!--</div>-->

        <span class="text text-danger" th:if="${#fields.hasErrors('price')}" th:errors="*{price}"></span>

    </div>
    </p>
    <br />

    <p>
    <label>Short Description:  &nbsp;  </label> <textarea rows=1 style="height:auto; width:100%;" th:field="*{description}" th:errorclass="form-field-error" />
    <span class="form-error-text" th:if="${#fields.hasErrors('description')}"
          th:errors="*{description}"></span></p><br />

    <p>
    <label>Features:</label> <textarea rows=2 style="height:auto; width:100%;" th:field="*{features}" th:errorclass="form-field-error" />
    <span class="form-error-text" th:if="${#fields.hasErrors('features')}"
          th:errors="*{features}"></span></p><br />

    <p></p> <label></label>
    <span style="display:inline-block;">
    &nbsp;
    <input class="btn btn-light"   style="text-align: center; margin: auto; width:100px" type="reset" value="Reset" /> &nbsp; &nbsp; &nbsp;
    <input class="btn btn-primary" style="text-align: center; margin: auto; width:100px"  type="submit" value="Submit" />
    </span>

</form>
<br /> <hr />

    <div th:replace="base :: modal"></div>
    <div th:replace="base :: footer"></div>
    <!-- Bootstrap core JavaScript-->
    <!--jQuery first, then Popper.js, then Bootstrap JS -->
<script src="https://code.jquery.com/jquery-3.3.1.js" integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
        crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.bundle.min.js" integrity="sha384-xrRywqdh3PHs8keKZN+8zzc5TX0GRTLCcmivcbNJWm2rs5C8PRhcEn3czEjhAO9o" crossorigin="anonymous"></script>
</body>
</html>